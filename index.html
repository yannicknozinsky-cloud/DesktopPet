<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Meine Supabase Daten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Supabase JS SDK -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 20px;
      background: #f7f7f7;
    }
    h2 {
      margin-top: 30px;
    }
    ul {
      padding: 0;
      list-style: none;
    }
    li {
      background: white;
      padding: 12px;
      margin-bottom: 12px; /* Abstand zwischen EintrÃ¤gen */
      border-radius: 8px;
    }
    a {
      text-decoration: none;
      color: #2a9d8f;
      font-weight: bold;
    }
    .term-field {
      margin-right: 8px;
    }
    #loginDiv {
      margin-bottom: 20px;
    }
  </style>
</head>

<body>

<h1>ğŸ“± Meine Supabase Daten</h1>

<!-- Login -->
<div id="loginDiv">
  Passwort: <input type="password" id="pwInput">
  <button id="pwBtn">Einloggen</button>
</div>

<!-- Content erst sichtbar nach Login -->
<div id="content" style="display:none;">
  <h2>ğŸŒ Websites</h2>
  <ul id="websites"></ul>

  <h2>ğŸ“… Termine</h2>
  <ul id="termine"></ul>
</div>

<script>
  const PASSWORD = "meinGeheimesPasswort"; // âš ï¸ sichtbar im Quellcode
  const supabaseUrl = "https://qkmtybzdthrpjfkbgskw.supabase.co";
  const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrbXR5YnpkdGhycGpma2Jnc2t3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4ODI3ODIsImV4cCI6MjA4MzQ1ODc4Mn0.VO1Bz0vKO4xTrcu-XCsZlrF4HgvgdbGLz3KKFRfG0Do";
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey);

  document.getElementById("pwBtn").onclick = () => {
    const input = document.getElementById("pwInput").value;
    if (input === PASSWORD) {
      document.getElementById("loginDiv").style.display = "none";
      document.getElementById("content").style.display = "block";
      loadWebsites();
      loadTermine();
    } else {
      alert("Falsches Passwort!");
    }
  };

  async function loadWebsites() {
    const { data, error } = await supabaseClient
      .from("websites")
      .select("name, url")
      .order("name");

    if (error) {
      console.error("Fehler beim Laden der Websites:", error);
      return;
    }

    const ul = document.getElementById("websites");
    ul.innerHTML = "";
    data.forEach(w => {
      const li = document.createElement("li");
      li.innerHTML = `<a href="${w.url}" target="_blank">${w.name}</a>`;
      ul.appendChild(li);
    });
  }

  async function loadTermine() {
    const { data, error } = await supabaseClient
      .from("termine")
      .select("name, datum, uhrzeitstart, uhrzeitende, ort")
      .order("datum");

    if (error) {
      console.error("Fehler beim Laden der Termine:", error);
      return;
    }

    const ul = document.getElementById("termine");
    ul.innerHTML = "";

    data.forEach(t => {
      // Uhrzeiten auf HH:MM trimmen
      const start = t.uhrzeitstart ? t.uhrzeitstart.slice(0,5) : "";
      const ende  = t.uhrzeitende   ? t.uhrzeitende.slice(0,5) : "";

      // Wochentag berechnen
      let weekday = "";
      if(t.datum){
        const dateObj = new Date(t.datum);
        weekday = dateObj.toLocaleDateString('de-DE', { weekday: 'long' });
      }

      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${t.name}</strong><br>
        ğŸ“… ${weekday}, ${t.datum} <br>
        â° ${start} - ${ende}<br>
        ğŸ“ ${t.ort || ""}
      `;
      ul.appendChild(li);
    });
  }
</script>

</body>
</html>
